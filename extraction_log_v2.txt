================================================================================
KNOWLEDGE GRAPH EXTRACTION - SINGLE TEXT TEST (LM Studio)
Using LangExtract for: Source Grounding, Few-shot Learning, Long Doc Optimization
================================================================================
Model Provider: lmstudio
Model Name: local-model
LM Studio URL: http://localhost:1234/v1
Input JSON: /app/data/legal/processed/legal_background.jsonl
Record ID: UKSC-2009-0143
Text Field: text
Output Directory: /app/test_outputs/single_extraction_lmstudio_20260110_162126

LangExtract Configuration:
  â€¢ Extraction passes: 1
  â€¢ Max workers: 5
  â€¢ Max char buffer: 8000

Extraction Method: Two-Step Connectivity-Aware
  â€¢ Max disconnected: 1
  â€¢ Max iterations: 5
================================================================================

Checking LM Studio connection...
âœ“ LM Studio is reachable at http://localhost:1234/v1
  Available models: ['google/gemma-3-12b', 'qwen/qwen3-14b', 'unsloth/gpt-oss-20b', 'qwen/qwen3-8b', 'text-embedding-nomic-embed-text-v1.5']

Running extraction pipeline with LangExtract (LM Studio)...


================================================================================
STEP 1: LOADING INPUT DATA
================================================================================
Loading JSONL file: /app/data/legal/processed/legal_background.jsonl
âœ“ Found record at line 1
âœ“ Loaded record: UKSC-2009-0143
âœ“ Text field: text
âœ“ Text length: 1697 characters

Text preview (first 200 chars):
Sigma Finance Corporation is a structured investment vehicle (SIV) established to invest in certain types of asset-backed securities and other financ ial instruments. Sigma aimed to profit from the di...

================================================================================
STEP 2: INITIALIZING EXTRACTION PIPELINE (WITH LANGEXTRACT + LM STUDIO)
================================================================================
Using two-step extraction prompts:
  â€¢ Step 1 (initial): /app/src/kg_constructor/prompts/legal_background_prompt_step1_initial.txt
  â€¢ Step 2 (bridging): /app/src/kg_constructor/prompts/legal_background_prompt_step2_bridging.txt
âœ“ Client: LMStudioClient
âœ“ Model: lmstudio/local-model
âœ“ LM Studio URL: http://localhost:1234/v1
âœ“ Temperature: 0.0

LangExtract Features Enabled:
  âœ“ Source Grounding (char_start, char_end for each triple)
  âœ“ Few-shot Examples (guiding extraction quality)
  âœ“ Controlled Generation (JSON schema constraints)
  âœ“ Long Document Optimization (passes=1, workers=5)

================================================================================
STEP 3: EXTRACTING TRIPLES WITH LANGEXTRACT (LM STUDIO)
================================================================================
Using Two-Step Connectivity-Aware Extraction
  â€¢ Max disconnected components: 1
  â€¢ Max iterations: 5

WARNING:absl:Prompt alignment: non-exact match: [example#0] class='Triple' status=AlignmentStatus.MATCH_FUZZY text='John Smith ... senior software engineer' char_span=(0, 61)
WARNING:absl:Prompt alignment: non-exact match: [example#2] class='Triple' status=AlignmentStatus.MATCH_FUZZY text='Sarah Johnson ... represents the plaintiff' char_span=(0, 63)
[94m[1mLangExtract[0m: model=[92mlocal-model[0m [00:00][94m[1mLangExtract[0m: model=[92mlocal-model[0m, current=[92m4,061[0m chars, processed=[92m0[0m chars:  [00:00]DEBUG [LMStudio]: Raw response length: 2206
DEBUG [LMStudio]: Raw response (first 500 chars): ```json
[
  {
    "head": "Sigma Finance Corporation",
    "relation": "is_type_of",
    "tail": "structured investment vehicle",
    "inference": "explicit"
  },
  {
    "head": "Sigma Finance Corporation",
    "relation": "aimed_to",
    "tail": "profit from the difference between the cost of funding its activities and the returns made on its investment portfolio",
    "inference": "explicit"
  },
  {
    "head": "impact",
    "relation": "stemming_from",
    "tail": "the sub-prime mortgage ma...
[94m[1mLangExtract[0m: model=[92mlocal-model[0m, current=[92m4,061[0m chars, processed=[92m0[0m chars:  [03:25][94m[1mLangExtract[0m: model=[92mlocal-model[0m, current=[92m4,061[0m chars, processed=[92m0[0m chars:  [03:25]

Initial extraction:
  â€¢ Triples: 0
  â€¢ Components: 0

Final results:
  â€¢ Total triples: 0
  â€¢ Disconnected components: 0
  â€¢ Is connected: False
  â€¢ Total API calls: 1

âœ“ Extracted 0 triples

================================================================================
TRACEABILITY ANALYSIS (LangExtract Features)
================================================================================
Source grounded triples: 0/0 (0.0%)
Initial extraction triples: 0
Bridging triples (iterations 1+): 0

Sample triples with traceability:

================================================================================
SAVING TRACEABILITY FILES
================================================================================
âœ“ Saved all triples: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json/UKSC-2009-0143.json
âœ“ Saved bridging triples: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json/UKSC-2009-0143_bridging.json (0 triples)
âœ“ Saved few-shot examples: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json/UKSC-2009-0143_examples.json (3 examples)

================================================================================
STEP 4: CONVERTING TO GRAPHML
================================================================================

Converting JSON to GraphML
Input: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json
Output: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graphml
  Skipping UKSC-2009-0143_examples.json: Internal structure does not match Triple schema
Created 2 GraphML files
âœ“ Created 2 GraphML file(s)
  - /app/test_outputs/single_extraction_lmstudio_20260110_162126/graphml/UKSC-2009-0143_bridging.graphml
  - /app/test_outputs/single_extraction_lmstudio_20260110_162126/graphml/UKSC-2009-0143.graphml

================================================================================
STEP 5: GENERATING METADATA AND ANALYTICS
================================================================================
âœ“ Generated metadata: /app/test_outputs/single_extraction_lmstudio_20260110_162126/metadata/UKSC-2009-0143_metadata.json

Key Analytics:
  â€¢ Total triples: 0 (0 explicit, 0 contextual)
  â€¢ Source grounded: 0/0 (0%)
  â€¢ Unique entities: 0 (0 in text, 0 inferred)
  â€¢ Graph nodes: 0, edges: 0
  â€¢ Connected components: 0
  â€¢ Average degree: 0

================================================================================
STEP 6: CREATING ENTITY VISUALIZATION (LANGEXTRACT HTML)
================================================================================

Creating entity visualizations (text highlights)
Output: /app/test_outputs/single_extraction_lmstudio_20260110_162126/entity_viz
Created visualization: /app/test_outputs/single_extraction_lmstudio_20260110_162126/entity_viz/UKSC-2009-0143.html
Created 1 entity visualizations
âœ“ Created 1 entity visualization(s)
  - /app/test_outputs/single_extraction_lmstudio_20260110_162126/entity_viz/UKSC-2009-0143.html

================================================================================
STEP 7: CREATING GRAPH VISUALIZATION (PLOTLY NETWORK)
================================================================================

Creating graph visualizations (network view)
Input: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graphml
Output: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz
Found 2 GraphML files. Generating visualizations...

[1/2] Processing UKSC-2009-0143_bridging.graphml...
âœ“ Visualization saved to: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz/UKSC-2009-0143_bridging.html
  Nodes: 0
  Edges: 0
[2/2] Processing UKSC-2009-0143.graphml...
âœ“ Visualization saved to: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz/UKSC-2009-0143.html
  Nodes: 0
  Edges: 0

âœ“ All visualizations saved to: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz
Created 2 graph visualizations
âœ“ Created 2 graph visualization(s)
  - /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz/UKSC-2009-0143.html
  - /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz/UKSC-2009-0143_bridging.html

================================================================================
EXTRACTION COMPLETE
================================================================================
Output directory: /app/test_outputs/single_extraction_lmstudio_20260110_162126

Generated files:
  - JSON triples: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json/UKSC-2009-0143.json
  - Bridging triples: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json/UKSC-2009-0143_bridging.json
  - Few-shot examples: /app/test_outputs/single_extraction_lmstudio_20260110_162126/json/UKSC-2009-0143_examples.json
  - GraphML: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graphml/UKSC-2009-0143.graphml
  - Metadata: /app/test_outputs/single_extraction_lmstudio_20260110_162126/metadata/UKSC-2009-0143_metadata.json
  - Entity HTML: /app/test_outputs/single_extraction_lmstudio_20260110_162126/entity_viz/UKSC-2009-0143.html
  - Graph HTML: /app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz/UKSC-2009-0143.html

Traceability Summary:
  âœ“ Source Grounding: 0/0 triples with char positions
  âœ“ Iteration Tracking: 0 initial + 0 bridging triples
  âœ“ Few-shot Examples: 3 examples saved
  âœ“ Long Doc Optimization: passes=1, workers=5
================================================================================

================================================================================
SUCCESS! All files generated in: /app/test_outputs/single_extraction_lmstudio_20260110_162126
================================================================================

View the results:
  Metadata & Analytics: /app/test_outputs/single_extraction_lmstudio_20260110_162126/metadata/UKSC-2009-0143_metadata.json
  Entity visualization: file:///app/test_outputs/single_extraction_lmstudio_20260110_162126/entity_viz/UKSC-2009-0143.html
  Graph visualization:  file:///app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz/UKSC-2009-0143.html

Output structure:
/app/test_outputs/single_extraction_lmstudio_20260110_162126:
entity_viz
extract_single.py
graph_viz
graphml
json
metadata

/app/test_outputs/single_extraction_lmstudio_20260110_162126/entity_viz:
UKSC-2009-0143.html

/app/test_outputs/single_extraction_lmstudio_20260110_162126/graph_viz:
UKSC-2009-0143.html
UKSC-2009-0143_bridging.html

/app/test_outputs/single_extraction_lmstudio_20260110_162126/graphml:
UKSC-2009-0143.graphml
UKSC-2009-0143_bridging.graphml

/app/test_outputs/single_extraction_lmstudio_20260110_162126/json:
UKSC-2009-0143.json
UKSC-2009-0143_bridging.json
UKSC-2009-0143_examples.json

/app/test_outputs/single_extraction_lmstudio_20260110_162126/metadata:
UKSC-2009-0143_metadata.json
